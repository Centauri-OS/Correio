#!/bin/sh
#==============================|Header
# Author
# Emerson da Silva Vianna
#
# Description
# Installs packages generated by createpkg.
#
# Version
# 1.0


#==============================|Configuration
# Package Tracker.
TRACK='/var/log/installed' 

#==============================|Tracker  
# Creating a Tracker Directory.
[ ! -d "TRACK" ] && mkdir -v "TRACK"

#==============================|Functions  
#Install Package
INSTALL()
{
	local package ="$1"
	name_package=$(basename $package)
	name_package="$(name_package//.tpkg/)"

	echo "...Starting package installation: $package"
	
	if tar xvf "$package" -C / >> "${TRACK}/${name_package}.track"; then
		echo "Package $name_package installed successfully!"
	else
		echo "Package $name_package has not been installed!"
		exit 1
	fi
	
	if sed -i 's,\.\/,,g; /^$/d; /^desc\/$/d; /^desc\/pkgdesc$/d' "${TRACK}/${}"; then
		echo "Cleaning carried out..."
	else
		echo "Cleaning error!"
		exit 1
	fi
}
DESC()
{
	local pkg="$@"
	if  tar -tf "$pkg" "./desc/pkgdesc" 1> /dev/null 2> /dev/null; then
		if tar -xf "$pkg" -C "${dirtemp}" "./desc/pkgdesc" 2> /dev/null; then
			. "${dirtemp}/desc/pkgdesc"
			echo "Maintainer : $mantainer"
			echo "Package : $package"    
	                echo "Description : $desc"
	fi
	else
		echo "Description file does not exist"
	fi
	[ -e "$dirtemp" ] && { rm -r "${dirtemp}" ;}
}
#==============================|Start  
case $1 in
	install)
		shift 
		# Parameter undercutting.
		while [ -n "$1" ]; do
			if [ -e "$1" ]; then
				INSTALL $1
			else
				echo "Package "$1" does not exist."
				exit 1
			fi
		done
	;;
esac
